var $jscomp={scope:{},findInternal:function(c,g,e){c instanceof String&&(c=String(c));for(var p=c.length,h=0;h<p;h++){var v=c[h];if(g.call(e,v,h,c))return{i:h,v:v}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,g,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[g]=e.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,g,e,p){if(g){e=$jscomp.global;c=c.split(".");for(p=0;p<c.length-1;p++){var h=c[p];h in e||(e[h]={});e=e[h]}c=c[c.length-1];p=e[c];g=g(p);g!=p&&null!=g&&$jscomp.defineProperty(e,c,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,e){return $jscomp.findInternal(this,c,e).v}},"es6-impl","es3");
var Viz=function(c,g){function e(){$.getJSON("/api/scoreboard").done(function(b){r=b;p();$.getJSON("/scoreboard.json").done(function(d){y=d;for(d=0;d<y.scoreboard.length;d++){var a=y.scoreboard[d],b=H[a.name];f[b].servicesStatuses=Array(6);for(var D=0;D<a.services.length;D++){var c=a.services[D];f[b].servicesStatuses[z[c.id]]=101==c.status}}I();v()})})}function p(){0>t&&(t=r.round-1);if(t!==r.round){var b=r.round;$.getJSON("/api/events?from="+t).done(function(d){u=[];for(var a=0;a<d.length;++a)t<=
d[a][0]&&d[a][0]<b&&u.push(d[a]);u.sort(function(a,d){var b=parseInt(a[1]),k=parseInt(d[1]);return b<k?-1:b>k?1:0});q=q.concat(u);t=b;h()})}}function h(){for(var b=0,d=0;d<u.length;d++)n[z[u[d][2]]].visible&&b++;$("#attacks").find(".value").text(b)}function v(){var b=0;d3.selectAll(".node").each(function(){for(var d=d3.select(this),a=d.data()[0],k=!1,c=0;c<n.length;c++){var m=n[c].visible&&a.servicesStatuses[c],k=k||m;d.select(".service_"+c).attr("fill",m?n[c].color:"#1D3542")}k&&b++});$("#alive").find(".value").text(b)}
function J(){if("0"!=r.status){if(0>w)if(0<q.length)w=q[0][1]-1E3;else return;for(var b=w+1E3;0<q.length&&q[0][1]<b;){var d=q.shift(),a=function(a){return function(){P(a)}}({from:E[d[3]],to:E[d[4]],svc:z[d[2]]});setTimeout(a,d[1]-w)}w=b}}function I(){for(var b=0;b<f.length;b++)f[b].score=r.table[f[b].team_id];b=_.groupBy(f,"score");groupsArray=[];for(var d in b)b.hasOwnProperty(d)&&groupsArray.push({key:parseFloat(d),value:b[d]});groupsArray=_.sortBy(groupsArray,"key").reverse();d=1;for(i=0;i<groupsArray.length;i++){var b=
groupsArray[i].value,a=d+b.length-1;for(j=0;j<b.length;j++)b[j].place=d===a?d+"":d+"-"+a;d=a+1}void 0!=A&&(d=K(f[A]),$(".team-tooltip").empty().append(d))}function L(){var b=$("#svg-viz"),d=b.height(),b=b.width(),a=Q(f),k=Math.max(f[0].width,f[0].height);a.dx+=2*k;a.dy+=5*k;a.x+=.5*k;a.y+=.5*k;k=Math.min(b/a.dx,d/a.dy);M.translate([b/2-k*a.x,d/2-k*a.y]).scale(k).event(x)}function Q(b){var d,a,k=d=Number.MAX_VALUE,c=a=Number.MIN_VALUE;b.forEach(function(b){void 0!=b&&(k=Math.min(b.x,k),c=Math.max(b.x,
c),d=Math.min(b.y,d),a=Math.max(b.y,a))});return{x:(c+k)/2,y:(a+d)/2,dx:c-k,dy:a-d}}function P(b){var d=n[b.svc];d.visible&&(b=B.selectAll(".arrow"+F).data([b]).enter().append("g").attr("class",".arrow"+F),F++,b.each(function(){var a=d3.select(this),b=a.data()[0],c=f[b.from],m=f[b.to],b=c.x+c.width/2,c=c.y+c.height/2,e=m.x+m.width/2,l=m.y+m.height/2,g=e-b,h=l-c,n=Math.sqrt(g*g+h*h),p=Math.atan2(h,g),g=180*p/Math.PI,q="grad"+N,r=d.color;N++;var h=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("basis"),
t=-n/4,n=[{x:b,y:c},{x:b+n/2+t*Math.sin(p),y:c+t*Math.cos(p)},{x:b+n,y:c+.01}];a.append("path").attr("class","arrow-line").attr("d",h(n)).attr("stroke","url(#"+q+")");a.attr("transform","rotate("+g+" "+b+" "+c+")");R(q,r);setTimeout(function(){a.remove();C.select("#"+q).remove()},1200);setTimeout(function(){S(q+"radial",r);var a=B.append("circle").attr("class","explosion").attr("r",m.width/3).attr("cx",e).attr("cy",l).attr("fill","url(#"+q+"radial)");setTimeout(function(){a.style("fill-opacity",0)},
100);setTimeout(function(){C.select("#"+q+"radial").remove();a.remove()},400)},800)}))}function T(b){for(var d=[],a=0;a<b;a++)d.push({x:45*O[a][0],y:26*O[a][1]});return d}function K(b){var d="<table><td><img src='https://ructfe.org/logos/"+md5(b.name)+".png'/></td><td><div class='header-wrapper'><span class='header'></span> <span class='value team-name'>",a;a=b.name;a=$("<div/>").text(a).html();return d+a+"</span></div><div><span class='header'>Place:</span> <span class='value'>"+b.place+"</span></div><div><span class='header'>Score:</span> <span class='value'>"+
b.score+"</span></div></td></tr></table>"}function S(b,d){var a=C.append("radialGradient").attr("id",b);a.append("stop").attr("offset",.02).attr("stop-color","white").attr("stop-opacity",1);a.append("stop").attr("offset",.37).attr("stop-color",d).attr("stop-opacity",1);a.append("stop").attr("offset",1).attr("stop-color",d).attr("stop-opacity",0)}function R(b,d){var a=x[0][0].getCurrentTime(),c=C.append("linearGradient").attr("id",b),e=.8*.4,m=.8*.1,f=.8+e+m;c.append("stop").attr("offset",0).attr("stop-color",
"white").attr("stop-opacity",0);var l=c.append("stop").attr("offset",0).attr("stop-color",d).attr("stop-opacity",1);l.append("animate").attr("attributeName","stop-opacity").attr("begin",a+m).attr("dur",e).attr("values","1;0").attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName","offset").attr("begin",a+e).attr("dur",.8).attr("values","0;1").attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName","stop-opacity").attr("begin",a+f).attr("dur",
"0.001s").attr("values","0;1").attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName","offset").attr("begin",a+f).attr("dur","0.001s").attr("values","1;0").attr("repeatCount",1).attr("fill","freeze");l=c.append("stop").attr("offset",0).attr("stop-color","white").attr("stop-opacity",1);l.append("animate").attr("attributeName","stop-color").attr("begin",a).attr("dur",m).attr("values","white;"+d).attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName",
"offset").attr("begin",a+m).attr("dur",.8).attr("values","0;1").attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName","stop-opacity").attr("begin",a+.8+m).attr("dur",e).attr("values","1;0").attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName","stop-color").attr("begin",a+f).attr("dur","0.001s").attr("values",d+";white").attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName","offset").attr("begin",a+f).attr("dur",
"0.001s").attr("values","1;0").attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName","stop-opacity").attr("begin",a+f).attr("dur","0.001s").attr("values","0;1").attr("repeatCount",1).attr("fill","freeze");e=c.append("stop").attr("offset",0).attr("stop-color","white").attr("stop-opacity",1);e.append("animate").attr("attributeName","offset").attr("begin",a).attr("dur",.8).attr("values","0;1").attr("repeatCount",1).attr("fill","freeze");e.append("animate").attr("attributeName",
"stop-color").attr("begin",a+.8).attr("dur",m).attr("values","white;"+d).attr("repeatCount",1).attr("fill","freeze");e.append("animate").attr("attributeName","offset").attr("begin",a+f).attr("dur","0.001s").attr("values","1;0").attr("repeatCount",1).attr("fill","freeze");e.append("animate").attr("attributeName","stop-color").attr("begin",a+f).attr("dur","0.001s").attr("values",d+";white").attr("repeatCount",1).attr("fill","freeze");m=c.append("stop").attr("offset",0).attr("stop-color","white").attr("stop-opacity",
0);m.append("animate").attr("attributeName","offset").attr("begin",a).attr("dur",.8).attr("values","0;1").attr("repeatCount",1).attr("fill","freeze");m.append("animate").attr("attributeName","offset").attr("begin",a+f).attr("dur","0.001s").attr("values","1;0").attr("repeatCount",1).attr("fill","freeze");c.append("stop").attr("offset",1).attr("stop-color","white").attr("stop-opacity",0)}var U={atlablog:4,weather:1,cartographer:3,sapmarine:2,crash:0,thebin:5},V="#ED953A #E5BD1F #3FE1D6 #568AFF #8C41DA #BA329E".split(" "),
W={atlablog:3,weather:4,cartographer:5,sapmarine:0,crash:1,thebin:2},r=g,f=[],E={},H={},n=Array(6),z={},u=[],G,N=0,F=0,A=void 0,y=void 0,t=-1,w=-1,q=[],O=[[19,20],[19,18],[18,19],[18,21],[19,22],[20,21],[21,20],[22,21],[21,22],[20,23],[21,24],[22,25],[21,26],[20,25],[6,11],[6,13],[7,12],[8,13],[9,12],[8,11],[8,9],[7,10],[7,14],[8,15],[7,16],[8,17],[9,16],[9,14],[10,15],[10,17],[9,18],[7,18],[8,19],[9,20],[10,19],[11,18],[12,17],[12,15],[11,16],[11,14],[8,23],[8,25],[8,21],[9,22],[22,19],[23,20],[22,
17],[21,16],[23,18],[24,19],[25,18],[24,17],[25,16],[24,15],[23,16],[23,14],[22,15],[21,14],[20,13],[21,12],[22,13],[25,20],[26,21],[27,22],[28,23],[29,24],[30,23],[29,22],[28,21],[27,20],[26,19],[27,18],[26,17],[26,15],[27,16],[13,24],[13,26],[13,28],[14,27],[15,28],[15,26],[14,25],[12,27],[11,28],[13,32],[13,30],[14,33],[14,31],[14,29],[15,30],[16,31],[17,30],[18,31],[18,33],[17,32],[16,33],[17,34],[15,32],[12,33],[13,34],[12,31],[11,32],[10,33],[28,17],[29,16],[30,17],[29,18],[28,19],[29,20],[24,
21],[6,9],[5,10],[5,12],[5,14],[4,13],[3,14],[3,12],[9,8],[9,6],[8,7],[12,9],[13,8],[14,7],[13,6],[17,10],[16,11],[15,12],[16,13],[17,12],[16,15],[21,10],[22,11],[23,12],[23,10],[23,8],[24,9],[24,11],[24,13],[25,12],[25,14],[6,19],[5,20],[4,21],[4,19],[3,18],[3,20],[4,23],[5,22],[6,21],[7,20],[7,22],[14,23],[15,24],[16,25],[27,10],[27,8],[27,6],[28,7],[29,6],[29,4],[31,8],[30,9],[29,10],[28,9],[29,8],[30,7],[30,11],[31,10],[31,12],[32,11],[6,27],[5,28],[4,27],[4,29],[3,28],[3,30],[3,32],[4,31],[5,
30],[6,29],[7,30],[7,32],[6,31],[7,34],[6,33],[5,32],[22,31],[23,30],[24,29],[25,28],[23,32],[22,33],[22,35],[23,34],[24,33],[25,32],[25,30],[24,31],[26,29],[27,30],[26,31],[27,28],[26,33],[27,34],[28,35],[29,34],[29,32],[29,30],[5,8],[4,7],[5,6],[6,7],[3,6],[4,5],[18,9],[12,5],[13,4],[31,26],[32,25],[33,24],[33,22],[33,20],[33,18],[32,19],[34,21],[35,22],[34,23],[34,25],[35,24],[35,26],[34,27],[34,29],[33,26],[33,28],[36,29],[35,28],[36,27],[36,25],[34,33],[33,34],[32,35],[32,33],[33,8],[34,7],[35,
8],[34,9],[35,10],[36,11],[37,12],[36,13],[36,15],[37,16],[37,18],[36,17],[37,20],[36,9],[37,10],[34,15],[34,13],[35,12],[35,14],[38,15],[3,4],[2,5],[2,13],[1,14],[0,15],[1,16],[2,15],[2,31],[1,32],[3,34],[4,37],[3,36],[2,37],[2,35],[5,38],[4,39],[10,35],[11,34],[11,36],[10,37],[11,38],[12,39],[12,37],[12,35],[13,36],[14,35],[26,39],[27,38],[28,39],[29,38],[29,40],[28,41],[27,40],[26,41],[28,37],[29,36],[27,36],[26,35],[35,36],[34,35],[34,37],[35,38],[34,39],[35,34],[33,36],[10,21],[11,20],[25,22],
[2,7],[1,6],[17,20],[2,27],[36,35],[37,34],[37,26],[19,30],[18,29],[30,5],[36,7],[37,8],[36,39],[32,39],[31,38],[31,36],[32,37],[33,38],[8,41],[8,39],[7,40],[6,39],[5,40],[4,41],[13,18],[13,16],[0,31],[0,33],[1,26],[2,3],[38,27],[37,40],[37,38],[33,40],[32,41],[38,25],[39,26],[39,14],[39,12],[38,13],[37,14],[36,5],[37,6],[38,5],[33,6],[21,8],[8,5],[5,4],[9,4],[12,29],[11,30],[9,32],[10,31],[10,29],[0,17],[1,18],[1,8],[8,3],[15,14],[30,3],[31,4],[18,7],[21,6],[22,7],[22,9],[23,6],[16,7],[17,6],[17,
8],[11,4],[10,5],[10,3],[9,2],[10,7],[11,6],[1,38],[2,39],[26,5],[27,4],[27,2],[32,3],[36,3],[37,4],[34,3],[34,1],[38,35],[11,40],[11,26],[12,25],[2,19],[2,21],[1,20],[12,7],[28,5],[36,37],[37,36],[38,41],[38,1],[4,3],[10,1],[8,1],[2,29],[1,28],[2,25],[1,40],[32,9],[33,10],[34,11],[33,4],[32,1],[33,2],[30,31],[1,4],[1,2],[0,1],[2,1],[39,28],[25,40],[-1,16],[-1,18],[39,34],[40,33],[41,34],[39,20],[40,21],[40,23],[41,20],[41,22],[40,35],[41,26],[41,18],[42,19],[3,38],[1,10],[0,9],[-1,8],[0,7],[-2,9],
[-2,23],[-3,24],[-3,26],[-2,25],[-1,26],[-2,29],[-4,20]];(function(){for(var b in c.teams)if(c.teams.hasOwnProperty(b)){var d=f.length;f.push({index:d,id:d,team_id:b,name:c.teams[b],score:0,place:null,status:0});E[b]=f.length-1;H[c.teams[b]]=f.length-1}})();(function(){for(var b in c.services)if(c.services.hasOwnProperty(b)){var d=U[c.services[b]];n[d]={id:d,service_id:b,name:c.services[b],color:V[d],visible:!0};z[b]=d}})();(function(){for(var b=$("#filters-container"),d=0;d<n.length;d++){var a=n[d],
c=$('<div class="filter"><span class="bullet">&#9679;&ensp;&thinsp;</span><span class="service-name">'+a.name+"</span></div>");c.css("color","#B7E99B");c.find(".bullet").css("color",a.color);c.click(function(a){return function(){$(this).hasClass("deselected")?($(this).removeClass("deselected"),n[a].visible=!0):($(this).addClass("deselected"),n[a].visible=!1);v();h()}}(d));b.append(c)}})();I();var x=d3.select("#svg-viz"),B=x.append("g").classed("container",!0),C=x.append("defs"),M=d3.behavior.zoom().scaleExtent([.25,
3]).size([1366,662]).on("zoom",function(){B.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")});x.call(M);(function(){var b=T(f.length);G=B.selectAll(".node").data(f).enter().append("g").attr("class","node");G.each(function(){var d=d3.select(this),a=d.data()[0];a.width=60;a.height=51.96;var c=b.shift();a.x=c.x;a.y=c.y;c=[{x:a.width/4,y:0},{x:3*a.width/4,y:0},{x:a.width,y:a.height/2},{x:3*a.width/4,y:a.height},{x:a.width/4,y:a.height},{x:0,y:a.height/2}];d.append("polygon").classed("island",
!0).attr("points",c.map(function(a){return[a.x,a.y].join()}).join(" ")).attr("transform","translate("+a.x+", "+a.y+")").attr("fill-opacity",0);for(var e=a.width/2,f=a.height/2,g=0;6>g;g++){var l=W[n[g].name],h=e+.55*(e-c[l].x),l=f+.55*(f-c[l].y);d.append("circle").classed("service",!0).classed("service_"+n[g].id,!0).attr("r",5).attr("cx",h).attr("cy",l).attr("fill","#1D3542").attr("transform","translate("+a.x+", "+a.y+")")}});L();$("#find-team-wrapper").find("input").on("keyup paste",function(){var b=
$(this).val().toLowerCase();G.each(function(){var a=d3.select(this),c=a.data()[0],c=b.length?0===c.name.toLowerCase().indexOf(b):!1;a.select(".island").attr("fill-opacity",c?1:0)})})})();setTimeout(function(){J();setInterval(J,1E3)},0);setTimeout(function(){e();setInterval(e,3E4)},0);$(window).resize(function(){L()});$("#svg-wrapper").tooltip({items:".node",track:!0,show:{effect:"fadeIn",delay:100,duration:80},hide:{effect:"fadeOut",delay:50,duration:40},content:function(){var b=d3.select(this).data()[0],
c=K(b);A=b.id;return"<div class='team-tooltip'>"+c+"</div>"},close:function(){A=void 0}});$(".ui-helper-hidden-accessible").remove();return{getTeamsData:function(){return f},getInfo:function(){return c},getScoreboard:function(){return r},getPendingEvents:function(){return q},getScoreboardPageData:function(){return y}}};
