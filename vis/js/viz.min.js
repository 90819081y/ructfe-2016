var $jscomp={scope:{},findInternal:function(c,g,e){c instanceof String&&(c=String(c));for(var p=c.length,h=0;h<p;h++){var v=c[h];if(g.call(e,v,h,c))return{i:h,v:v}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,g,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[g]=e.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,g,e,p){if(g){e=$jscomp.global;c=c.split(".");for(p=0;p<c.length-1;p++){var h=c[p];h in e||(e[h]={});e=e[h]}c=c[c.length-1];p=e[c];g=g(p);g!=p&&null!=g&&$jscomp.defineProperty(e,c,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,e){return $jscomp.findInternal(this,c,e).v}},"es6-impl","es3");
var Viz=function(c,g){function e(){$.getJSON("./api/scoreboard").done(function(b){r=b;p();$.getJSON("./scoreboard.json").done(function(d){y=d;for(d=0;d<y.scoreboard.length;d++){var a=y.scoreboard[d],b=H[a.name];f[b].servicesStatuses=Array(6);for(var D=0;D<a.services.length;D++){var c=a.services[D];f[b].servicesStatuses[z[c.id]]=101==c.status}}I();v()})})}function p(){0>t&&(t=r.round-1);if(t!==r.round){var b=r.round;$.getJSON("./api/events?from="+t).done(function(d){u=[];for(var a=0;a<d.length;++a)t<=
d[a][0]&&d[a][0]<b&&u.push(d[a]);u.sort(function(a,d){var b=parseInt(a[1]),k=parseInt(d[1]);return b<k?-1:b>k?1:0});q=q.concat(u);t=b;h()})}}function h(){for(var b=0,d=0;d<u.length;d++)n[z[u[d][2]]].visible&&b++;$("#attacks").find(".value").text(b)}function v(){var b=0;d3.selectAll(".node").each(function(){for(var d=d3.select(this),a=d.data()[0],k=!1,c=0;c<n.length;c++){var m=n[c].visible&&a.servicesStatuses[c],k=k||m;d.select(".service_"+c).attr("fill",m?n[c].color:"#1D3542")}k&&b++});$("#alive").find(".value").text(b)}
function J(){if("0"!=r.status){if(0>w)if(0<q.length)w=q[0][1]-1E3;else return;for(var b=w+1E3;0<q.length&&q[0][1]<b;){var d=q.shift(),a=function(a){return function(){P(a)}}({from:E[d[3]],to:E[d[4]],svc:z[d[2]]});setTimeout(a,d[1]-w)}w=b}}function I(){for(var b=0;b<f.length;b++)f[b].score=r.table[f[b].team_id];b=_.groupBy(f,"score");groupsArray=[];for(var d in b)b.hasOwnProperty(d)&&groupsArray.push({key:parseFloat(d),value:b[d]});groupsArray=_.sortBy(groupsArray,"key").reverse();d=1;for(i=0;i<groupsArray.length;i++){var b=
groupsArray[i].value,a=d+b.length-1;for(j=0;j<b.length;j++)b[j].place=d===a?d+"":d+"-"+a;d=a+1}void 0!=A&&(d=K(f[A]),$(".team-tooltip").empty().append(d))}function L(){var b=$("#svg-viz"),d=b.height(),b=b.width(),a=Q(f),k=Math.max(f[0].width,f[0].height);a.dx+=2*k;a.dy+=5*k;a.x+=.5*k;a.y+=.5*k;k=Math.min(b/a.dx,d/a.dy);M.translate([b/2-k*a.x,d/2-k*a.y]).scale(k).event(x)}function Q(b){var d,a,k=d=Number.MAX_VALUE,c=a=Number.MIN_VALUE;b.forEach(function(b){void 0!=b&&(k=Math.min(b.x,k),c=Math.max(b.x,
c),d=Math.min(b.y,d),a=Math.max(b.y,a))});return{x:(c+k)/2,y:(a+d)/2,dx:c-k,dy:a-d}}function P(b){var d=n[b.svc];d.visible&&(b=B.selectAll(".arrow"+F).data([b]).enter().append("g").attr("class",".arrow"+F),F++,b.each(function(){var a=d3.select(this),b=a.data()[0],c=f[b.from],m=f[b.to],b=c.x+c.width/2,c=c.y+c.height/2,e=m.x+m.width/2,l=m.y+m.height/2,g=e-b,h=l-c,n=Math.sqrt(g*g+h*h),p=Math.atan2(h,g),g=180*p/Math.PI,q="grad"+N,r=d.color;N++;var h=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("basis"),
t=-n/4,n=[{x:b,y:c},{x:b+n/2+t*Math.sin(p),y:c+t*Math.cos(p)},{x:b+n,y:c+.01}];a.append("path").attr("class","arrow-line").attr("d",h(n)).attr("stroke","url(#"+q+")");a.attr("transform","rotate("+g+" "+b+" "+c+")");R(q,r);setTimeout(function(){a.remove();C.select("#"+q).remove()},1200);setTimeout(function(){S(q+"radial",r);var a=B.append("circle").attr("class","explosion").attr("r",m.width/3).attr("cx",e).attr("cy",l).attr("fill","url(#"+q+"radial)");setTimeout(function(){a.style("fill-opacity",0)},
100);setTimeout(function(){C.select("#"+q+"radial").remove();a.remove()},400)},800)}))}function T(b){for(var d=[],a=0;a<b;a++)d.push({x:O[a][0],y:O[a][1]});return d}function K(b){var d="<table><td><img src='https://ructfe.org/logos/"+md5(b.name)+".png'/></td><td><div class='header-wrapper'><span class='header'></span> <span class='value team-name'>",a;a=b.name;a=$("<div/>").text(a).html();return d+a+"</span></div><div><span class='header'>Place:</span> <span class='value'>"+b.place+"</span></div><div><span class='header'>Score:</span> <span class='value'>"+
b.score+"</span></div></td></tr></table>"}function S(b,d){var a=C.append("radialGradient").attr("id",b);a.append("stop").attr("offset",.02).attr("stop-color","white").attr("stop-opacity",1);a.append("stop").attr("offset",.37).attr("stop-color",d).attr("stop-opacity",1);a.append("stop").attr("offset",1).attr("stop-color",d).attr("stop-opacity",0)}function R(b,d){var a=x[0][0].getCurrentTime(),c=C.append("linearGradient").attr("id",b),e=.8*.4,m=.8*.1,f=.8+e+m;c.append("stop").attr("offset",0).attr("stop-color",
"white").attr("stop-opacity",0);var l=c.append("stop").attr("offset",0).attr("stop-color",d).attr("stop-opacity",1);l.append("animate").attr("attributeName","stop-opacity").attr("begin",a+m).attr("dur",e).attr("values","1;0").attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName","offset").attr("begin",a+e).attr("dur",.8).attr("values","0;1").attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName","stop-opacity").attr("begin",a+f).attr("dur",
"0.001s").attr("values","0;1").attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName","offset").attr("begin",a+f).attr("dur","0.001s").attr("values","1;0").attr("repeatCount",1).attr("fill","freeze");l=c.append("stop").attr("offset",0).attr("stop-color","white").attr("stop-opacity",1);l.append("animate").attr("attributeName","stop-color").attr("begin",a).attr("dur",m).attr("values","white;"+d).attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName",
"offset").attr("begin",a+m).attr("dur",.8).attr("values","0;1").attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName","stop-opacity").attr("begin",a+.8+m).attr("dur",e).attr("values","1;0").attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName","stop-color").attr("begin",a+f).attr("dur","0.001s").attr("values",d+";white").attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName","offset").attr("begin",a+f).attr("dur",
"0.001s").attr("values","1;0").attr("repeatCount",1).attr("fill","freeze");l.append("animate").attr("attributeName","stop-opacity").attr("begin",a+f).attr("dur","0.001s").attr("values","0;1").attr("repeatCount",1).attr("fill","freeze");e=c.append("stop").attr("offset",0).attr("stop-color","white").attr("stop-opacity",1);e.append("animate").attr("attributeName","offset").attr("begin",a).attr("dur",.8).attr("values","0;1").attr("repeatCount",1).attr("fill","freeze");e.append("animate").attr("attributeName",
"stop-color").attr("begin",a+.8).attr("dur",m).attr("values","white;"+d).attr("repeatCount",1).attr("fill","freeze");e.append("animate").attr("attributeName","offset").attr("begin",a+f).attr("dur","0.001s").attr("values","1;0").attr("repeatCount",1).attr("fill","freeze");e.append("animate").attr("attributeName","stop-color").attr("begin",a+f).attr("dur","0.001s").attr("values",d+";white").attr("repeatCount",1).attr("fill","freeze");m=c.append("stop").attr("offset",0).attr("stop-color","white").attr("stop-opacity",
0);m.append("animate").attr("attributeName","offset").attr("begin",a).attr("dur",.8).attr("values","0;1").attr("repeatCount",1).attr("fill","freeze");m.append("animate").attr("attributeName","offset").attr("begin",a+f).attr("dur","0.001s").attr("values","1;0").attr("repeatCount",1).attr("fill","freeze");c.append("stop").attr("offset",1).attr("stop-color","white").attr("stop-opacity",0)}var U={atlablog:4,weather:1,cartographer:3,sapmarine:2,crash:0,thebin:5},V="#ED953A #E5BD1F #3FE1D6 #568AFF #8C41DA #BA329E".split(" "),
W={atlablog:3,weather:4,cartographer:5,sapmarine:0,crash:1,thebin:2},r=g,f=[],E={},H={},n=Array(6),z={},u=[],G,N=0,F=0,A=void 0,y=void 0,t=-1,w=-1,q=[],O=_.uniq([[855,545],[855,493],[810,519],[810,571],[855,597],[900,571],[945,545],[990,571],[945,597],[900,623],[945,649],[990,675],[945,701],[900,675],[270,311],[270,363],[315,337],[360,363],[405,337],[360,311],[360,259],[315,285],[315,389],[360,415],[315,441],[360,467],[405,441],[405,389],[450,415],[450,467],[405,493],[315,493],[360,519],[405,545],
[450,519],[495,493],[540,467],[540,415],[495,441],[495,389],[360,623],[360,675],[360,571],[405,597],[990,519],[1035,545],[990,467],[945,441],[1035,493],[1080,519],[1125,493],[1080,467],[1125,441],[1080,415],[1035,441],[1035,389],[990,415],[945,389],[900,363],[945,337],[990,363],[1125,545],[1170,571],[1215,597],[1260,623],[1305,649],[1350,623],[1305,597],[1260,571],[1215,545],[1170,519],[1215,493],[1170,467],[1170,415],[1215,441],[585,649],[585,701],[585,753],[630,727],[675,753],[675,701],[630,675],
[540,727],[495,753],[585,857],[585,805],[630,883],[630,831],[630,779],[675,805],[720,831],[765,805],[810,831],[810,883],[765,857],[720,883],[765,909],[675,857],[540,883],[585,909],[540,831],[495,857],[450,883],[1260,467],[1305,441],[1350,467],[1305,493],[1260,519],[1305,545],[1080,571],[270,259],[225,285],[225,337],[225,389],[180,363],[135,389],[135,337],[405,233],[405,181],[360,207],[540,259],[585,233],[630,207],[585,181],[765,285],[720,311],[675,337],[720,363],[765,337],[720,415],[945,285],[990,
311],[1035,337],[1035,285],[1035,233],[1080,259],[1080,311],[1080,363],[1125,337],[1125,389],[270,519],[225,545],[180,571],[180,519],[135,493],[135,545],[180,623],[225,597],[270,571],[315,545],[315,597],[630,623],[675,649],[720,675],[1215,285],[1215,233],[1215,181],[1260,207],[1305,181],[1305,129],[1395,233],[1350,259],[1305,285],[1260,259],[1305,233],[1350,207],[1350,311],[1395,285],[1395,337],[1440,311],[270,727],[225,753],[225,753],[180,727],[180,779],[135,753],[135,805],[135,857],[180,831],[225,
805],[270,779],[315,805],[315,857],[270,831],[315,909],[270,883],[225,857],[990,831],[1035,805],[1080,779],[1125,753],[1035,857],[990,883],[990,935],[1035,909],[1080,883],[1125,857],[1125,805],[1080,831],[1170,779],[1215,805],[1170,831],[1215,753],[1170,883],[1215,909],[1260,935],[1305,909],[1305,857],[1305,805],[225,233],[180,207],[225,181],[270,207],[135,181],[180,155],[810,259],[540,155],[585,129],[1395,701],[1440,675],[1485,649],[1485,597],[1485,545],[1485,493],[1440,519],[1530,571],[1575,597],
[1530,623],[1530,675],[1575,649],[1575,701],[1530,727],[1530,779],[1485,701],[1485,753],[1620,779],[1575,753],[1620,727],[1620,675],[1530,883],[1485,909],[1440,935],[1440,883],[1485,233],[1530,207],[1575,233],[1530,259],[1575,285],[1620,311],[1665,337],[1620,363],[1620,415],[1665,441],[1665,493],[1620,467],[1665,545],[1620,259],[1665,285],[1530,415],[1530,363],[1575,337],[1575,389],[1710,415],[135,129],[90,155],[90,363],[45,389],[0,415],[45,441],[90,415],[90,831],[45,857],[135,909],[180,987],[135,
961],[90,987],[90,935],[225,1013],[180,1039],[450,935],[495,909],[495,961],[450,987],[495,1013],[540,1039],[540,987],[540,935],[585,961],[630,935],[1170,1039],[1215,1013],[1260,1039],[1305,1013],[1305,1065],[1260,1091],[1215,1065],[1170,1091],[1170,1091],[1260,987],[1305,961],[1215,961],[1170,935],[1575,961],[1530,935],[1530,987],[1575,1013],[1530,1039],[1575,909],[1485,961],[450,571],[495,545],[1125,597],[90,207],[45,181],[765,545],[90,727],[1620,935],[1665,909],[1665,701],[855,805],[810,779],[1350,
155],[1620,207],[1665,233],[1620,1039],[1440,1039],[1395,1013],[1395,961],[1440,987],[1485,1013],[360,1091],[360,1039],[315,1065],[270,1039],[225,1065],[180,1091],[585,493],[585,441],[0,831],[0,883],[45,701],[90,103],[1710,727],[1665,1065],[1665,1013],[1485,1065],[1440,1091],[1710,675],[1755,701],[1755,389],[1755,337],[1710,363],[1665,389],[1620,155],[1665,181],[1710,155],[1485,181],[945,233],[360,155],[225,129],[405,129],[540,779],[495,805],[405,857],[450,831],[450,779],[0,467],[45,493],[45,233],
[360,103],[675,389],[1350,103],[1395,129],[810,207],[945,181],[990,207],[990,259],[1035,181],[720,207],[765,181],[765,233],[495,129],[450,155],[450,103],[405,77],[450,207],[495,181],[45,1013],[90,1039],[1170,155],[1215,129],[1215,77],[1440,103],[1620,103],[1665,129],[1530,103],[1530,51],[1710,935],[495,1065],[495,701],[540,675],[90,519],[90,571],[45,545],[540,207],[1260,155],[1620,987],[1665,961],[1710,1091],[1710,51],[180,103],[450,51],[360,51],[90,779],[45,753],[90,675],[45,1065],[1440,259],[1485,
285],[1530,311],[1485,129],[1440,51],[1485,77],[1350,831],[45,129],[45,77],[0,51],[90,51],[1755,753],[1125,1065],[-45,441],[-45,493],[1755,909],[1800,883],[1845,909]],function(b){return JSON.stringify(b)});(function(){for(var b in c.teams)if(c.teams.hasOwnProperty(b)){var d=f.length;f.push({index:d,id:d,team_id:b,name:c.teams[b],score:0,place:null,status:0});E[b]=f.length-1;H[c.teams[b]]=f.length-1}})();(function(){for(var b in c.services)if(c.services.hasOwnProperty(b)){var d=U[c.services[b]];n[d]=
{id:d,service_id:b,name:c.services[b],color:V[d],visible:!0};z[b]=d}})();(function(){for(var b=$("#filters-container"),d=0;d<n.length;d++){var a=n[d],c=$('<div class="filter"><span class="bullet">&#9679;&ensp;&thinsp;</span><span class="service-name">'+a.name+"</span></div>");c.css("color","#B7E99B");c.find(".bullet").css("color",a.color);c.click(function(a){return function(){$(this).hasClass("deselected")?($(this).removeClass("deselected"),n[a].visible=!0):($(this).addClass("deselected"),n[a].visible=
!1);v();h()}}(d));b.append(c)}})();I();var x=d3.select("#svg-viz"),B=x.append("g").classed("container",!0),C=x.append("defs"),M=d3.behavior.zoom().scaleExtent([.25,3]).size([1366,662]).on("zoom",function(){B.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")});x.call(M);(function(){var b=T(f.length);G=B.selectAll(".node").data(f).enter().append("g").attr("class","node");G.each(function(){var d=d3.select(this),a=d.data()[0];a.width=60;a.height=51.96;var c=b.shift();a.x=
c.x;a.y=c.y;c=[{x:a.width/4,y:0},{x:3*a.width/4,y:0},{x:a.width,y:a.height/2},{x:3*a.width/4,y:a.height},{x:a.width/4,y:a.height},{x:0,y:a.height/2}];d.append("polygon").classed("island",!0).attr("points",c.map(function(a){return[a.x,a.y].join()}).join(" ")).attr("transform","translate("+a.x+", "+a.y+")").attr("fill-opacity",0);for(var e=a.width/2,f=a.height/2,g=0;6>g;g++){var l=W[n[g].name],h=e+.55*(e-c[l].x),l=f+.55*(f-c[l].y);d.append("circle").classed("service",!0).classed("service_"+n[g].id,
!0).attr("r",5).attr("cx",h).attr("cy",l).attr("fill","#1D3542").attr("transform","translate("+a.x+", "+a.y+")")}});L();$("#find-team-wrapper").find("input").on("keyup paste",function(){var b=$(this).val().toLowerCase();G.each(function(){var a=d3.select(this),c=a.data()[0],c=b.length?0===c.name.toLowerCase().indexOf(b):!1;a.select(".island").attr("fill-opacity",c?1:0)})})})();setTimeout(function(){J();setInterval(J,1E3)},0);setTimeout(function(){e();setInterval(e,3E4)},0);$(window).resize(function(){L()});
$("#svg-wrapper").tooltip({items:".node",track:!0,show:{effect:"fadeIn",delay:100,duration:80},hide:{effect:"fadeOut",delay:50,duration:40},content:function(){var b=d3.select(this).data()[0],c=K(b);A=b.id;return"<div class='team-tooltip'>"+c+"</div>"},close:function(){A=void 0}});$(".ui-helper-hidden-accessible").remove();return{getTeamsData:function(){return f},getInfo:function(){return c},getScoreboard:function(){return r},getPendingEvents:function(){return q},getScoreboardPageData:function(){return y}}};
